name: executon control workflow
on:
  push:
    branches:
      - main
      - dev
jobs:
  test:
    environment: testing
    runs-on: ubuntu-latest
    steps:
      - name: Get Code
        uses: actions/checkout@v3
      - name: Cache dependencies
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: npm-deps-${{ hashFiles('**/package-lock.json') }}
      - name: Install dependencies
        run: npm ci
        # here I add the if key , then confirm that the next step regarding uploading the test report should only happen if we have a failing test 
        # we add an Id to this run tests step so that we check if the step failed or not and then we use that in our if expression by the upload test results step 
      - name: Run tests
        id: run_tests
        run: npm test
        # add this step below informing the pipeline to continue on error 
        continue-on-error: true

      - name: upload test results
      # this step will only run if the tests fail
      # we look in the step context -> Get the id for that step that ran -> check the outcome of that step to see if it passed or failed 
      # When the test fails in the run tests , then github will do its defait behavior of stopping the workflow but we dont wa that to happen , we want it to continue to the next step so we can execute the upload test results step
      # to do this we add a special function that says the stem when a step fails failure () then we combine it with && to the steps if statmeent that checks if the outcome of the run tests step is failure
      # 
        if: ${{ failure() && steps.run_tests.outcome == 'failure' }}
        uses: actions/upload-artifact@v4
        with:
          name: test-report
          path: dist/index.html
      - name: Output information
        run: echo "..."
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Output information
        run: |        
          echo "..."
